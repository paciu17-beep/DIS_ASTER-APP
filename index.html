<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIS-ASTER APS - Tesseramento Cloud</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Tua configurazione Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBlEDU-uS8tTMe1YCYDkHjJArHknIUn2HQ",
            authDomain: "disaster-cloud.firebaseapp.com",
            projectId: "disaster-cloud",
            storageBucket: "disaster-cloud.firebasestorage.app",
            messagingSenderId: "822184145467",
            appId: "1:822184145467:web:9dfa664d4a3cde74b1e21e"
        };

        // Inizializza Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Funzione per salvare sul CLOUD
        async function salvaSocio(event) {
            event.preventDefault();
            const btn = event.target.querySelector('button');
            btn.disabled = true;
            btn.innerText = "Salvataggio in corso...";

            const socio = {
                nome: document.getElementById('nome').value,
                cognome: document.getElementById('cognome').value,
                cf: document.getElementById('cf').value.toUpperCase(),
                telefono: document.getElementById('telefono').value,
                data: new Date().toLocaleString('it-IT')
            };

            try {
                await addDoc(collection(db, "soci"), socio);
                alert("Socio salvato nel Cloud con successo!");
                document.getElementById('formSocio').reset();
            } catch (e) {
                console.error("Errore: ", e);
                alert("Errore nel salvataggio Cloud. Riprova.");
            } finally {
                btn.disabled = false;
                btn.innerText = "Salva Socio";
            }
        }

        // Funzione per caricare i dati dal CLOUD nell'archivio
        async function caricaArchivio() {
            const lista = document.getElementById('listaSociCloud');
            lista.innerHTML = "Caricamento dati dal cloud...";
            
            try {
                const q = query(collection(db, "soci"), orderBy("data", "desc"));
                const querySnapshot = await getDocs(q);
                lista.innerHTML = "";
                
                querySnapshot.forEach((doc) => {
                    const s = doc.data();
                    const div = document.createElement('div');
                    div.className = "socio-item";
                    div.innerHTML = `<strong>${s.cognome} ${s.nome}</strong><br>CF: ${s.cf} | Tel: ${s.telefono}<br><small>${s.data}</small>`;
                    lista.appendChild(div);
                });
            } catch (e) {
                lista.innerHTML = "Errore nel caricamento.";
            }
        }

        window.salvaSocio = salvaSocio;
        window.caricaArchivio = caricaArchivio;
    </script>

    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #1a73e8; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom: 2px solid #1a73e8; color: #1a73e8; font-weight: bold; }
        #archivioSection { display: none; }
        .socio-item { padding: 10px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <h2>DIS-ASTER APS</h2>
    
    <div class="tabs">
        <div class="tab active" id="tabForm" onclick="switchTab('form')">Nuovo Socio</div>
        <div class="tab" id="tabArchivio" onclick="switchTab('archivio')">Archivio Cloud</div>
    </div>

    <div id="formSection">
        <form id="formSocio" onsubmit="salvaSocio(event)">
            <input type="text" id="nome" placeholder="Nome" required>
            <input type="text" id="cognome" placeholder="Cognome" required>
            <input type="text" id="cf" placeholder="Codice Fiscale" required>
            <input type="tel" id="telefono" placeholder="Telefono" required>
            <button type="submit">Salva Socio</button>
        </form>
    </div>

    <div id="archivioSection">
        <div id="listaSociCloud"></div>
    </div>
</div>

<script>
    function switchTab(type) {
        if(type === 'form') {
            document.getElementById('formSection').style.display = 'block';
            document.getElementById('archivioSection').style.display = 'none';
            document.getElementById('tabForm').classList.add('active');
            document.getElementById('tabArchivio').classList.remove('active');
        } else {
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('archivioSection').style.display = 'block';
            document.getElementById('tabForm').classList.remove('active');
            document.getElementById('tabArchivio').classList.add('active');
            caricaArchivio();
        }
    }
</script>

</body>
</html>
